<html>
    <head>
        <title>WildFly Container Quickstart</title>
        
         <script>
        function getEcho() {
            fetch('http://20.92.67.123/echo')
                .then (
                    function (response) {
                        if (response.status !== 200) {
                            document.getElementById("error").innerHTML = 'Get echo returned an error' + response.status;
                            return;
                        }
                        return response.json();
                    })
                    .then(function(data) {
                            console.log(data);
                            document.getElementById("success").innerHTML = document.getElementById("success").innerHTML + data.message;
                    })
                    .catch(function(err) {
                        document.getElementById("error").innerHTML = 'Error on call: ' + err;
                    });
        };
             
        function login() {
            const url = 'https://login.microsoftonline.com/9f822be9-3416-42fa-8d6c-7e0787e8b974/oauth2/v2.0/authorize?client_id=80f9e1ba-1232-41ff-8d0b-c34a9085bc6a&response_type=id_token token &nonce=abcd1234 &redirect_uri=https://wildflycontainerqs.af302b6b0eae45b58299.australiaeast.aksapp.io &response_mode=fragment &scope=openid &state=12345';

            fetch(url)
                .then (
                    function (response) {
                        if (response.status == 301) {
                            //document.getElementById("error").innerHTML = 'Get echo returned an error' + response.status;
                            return response.url;
                        }
                        return response.url;
                    })
                    .then(function(urltoken) {
                            console.log(urltoken);
                            document.getElementById("debug").innerHTML = document.getElementById("debug").innerHTML + urltoken;
                            const urlParts = new URLSearchParams(
                                urltoken.split("#")
                                );
                            let fragment = urlParts[1];
                            tokenResponse = Object.fromEntries(fragment);
                            document.getElementById("success").innerHTML = document.getElementById("success").innerHTML + tokenResponse.get('access_token');
                    })
                    .catch(function(err) {
                        document.getElementById("error").innerHTML = 'Error on call: ' + err;
                    });
        };
    </script>
        
    </head>
    <body>
        <div id="wildfly">
            You have the WildFly Container Quickstart up and running!
            <div id="success"><h2> Response: </h2></div>
            <div id="error"></div>
            <div id="debug"></div>
            <!--<button type="button" onclick="getEcho()">Get Echo</button>-->
            <button type="button" onclick="login()">Login</button>
        </div>
    </body>
    
   
    
</html>
